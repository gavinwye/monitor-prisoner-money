{% extends "layout.html" %}

{% block pageTitle %}
Prisoners
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">
      Prisoners search results
    </h1>
  </div>
  <div class="govuk-grid-column-full">
    <!-- <h2 class="govuk-heading-m">Search</h2> -->
    <form class="form" method="post">
      <div class="govuk-form-group">
        <label class="govuk-label" for="width-20">
          Prisoner number or name
        </label>
        <input class="govuk-input govuk-!-width-two-thirds" id="prisonerSearch" name="prisonerSearch" type="text" value="{{ data['prisonerSearch'] }}">
        <button type="submit" class="govuk-button">
          Search
        </button>
        <p><a href="/advanced-search/" class="govuk-link">Advanced search</a></p>
      </div>
    </form>

    {%- if data['prisonerSearch'] == '' -%}
    <p class="govuk-body-l">Your search for <span class="govuk-!-font-weight-bold">"{{ data['prisonerSearch'] }}"</span> returned no results <a href="/prisons/" class="govuk-link--no-visited-state">search again</a></p>
    {%- else -%}
    <p class="govuk-body-l">Search results for <span class="govuk-!-font-weight-bold">{{ data['prisonerSearch'] }}</span> <a href="/prisons/" class="govuk-link--no-visited-state">clear search</a></p>
    <!-- ********************************** -->

    <div class="govuk-tabs" data-module="tabs">
      <h2 class="govuk-tabs__title">
        Credits & Disbursements
      </h2>

      <ul class="govuk-tabs__list">
        <li class="govuk-tabs__list-item">
          <a class="govuk-tabs__tab govuk-tabs__tab--selected" href="#credits">
            Credits
          </a>
        </li>
        <li class="govuk-tabs__list-item">
          <a class="govuk-tabs__tab" href="#disbursements">
            Disbursements
          </a>
        </li>
      </ul>

      <section class="govuk-tabs__panel" id="credits">
        <h2 class="govuk-heading-l">Credits</h2>
        <table class="govuk-table govuk-!-font-size-14 ">
          <!-- <caption class="govuk-table__caption">Credits for your prisons sorted by date</caption> -->
          <thead class="govuk-table__head">
            <tr class="govuk-table__row hack-table-row-vertical-align-top">
              <th class="govuk-table__header" scope="col">Prisoner</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Credits recieved</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Total payment sources</th>
              <th class="govuk-table__header" scope="col">Prison</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Total amount of credits</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Action</th>
            </tr>
          </thead>
          <tbody class="govuk-table__body ">
            {%- for prisoner in prisoners -%}
              {%- if prisoner.credit_count >= 1 and data['prisonerSearch'] in [prisoner.prisoner_name,prisoner.prisoner_number] -%}
              <tr class="govuk-table__row hack-table-row-vertical-align-top">
                <td class="govuk-table__cell"><a href="#" class="govuk-link--no-visited-state">{{ prisoner.prisoner_name }}</a><br>{{ prisoner.prisoner_number }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric">{{ prisoner.credit_count }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric">{{ prisoner.sender_count }}</td>
                <td class="govuk-table__cell">{{ prisoner.prison_name }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric">{{ prisoner.credit_total }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric"><a href="#">View details</a></td>
              </tr>
              {%- endif -%}
            {%- endfor -%}
          </tbody>
        </table>

      </section>
      <section class="govuk-tabs__panel govuk-tabs__panel--hidden" id="disbursements">
        <h2 class="govuk-heading-l">Disbursements</h2>
        <table class="govuk-table govuk-!-font-size-14 ">
          <!-- <caption class="govuk-table__caption">Credits for your prisons sorted by date</caption> -->
          <thead class="govuk-table__head">
            <tr class="govuk-table__row hack-table-row-vertical-align-top">
              <th class="govuk-table__header" scope="col">Prisoner</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Total recipients</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Disbursements sent</th>
              <th class="govuk-table__header" scope="col">Prison</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Total amount of disbursements</th>
              <th class="govuk-table__header govuk-table__header--numeric" scope="col">Action</th>
            </tr>
          </thead>
          <tbody class="govuk-table__body ">
            {%- for prisoner in prisoners -%}
              {%- if prisoner.disbursement_count >= 1 and data['prisonerSearch'] in [prisoner.prisoner_name,prisoner.prisoner_number] -%}
              <tr class="govuk-table__row hack-table-row-vertical-align-top">
                <td class="govuk-table__cell"><a href="#" class="govuk-link--no-visited-state">{{ prisoner.prisoner_name }}</a><br>{{ prisoner.prisoner_number }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric">{{ prisoner.recipient_count }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric">{{ prisoner.disbursement_count }}</td>

                <td class="govuk-table__cell govuk-table__cell--numeric">{{ prisoner.disbursement_total }}</td>
                <td class="govuk-table__cell govuk-table__cell--numeric"><a href="#">View details</a></td>
              </tr>
              {%- endif -%}
            {%- endfor -%}
          </tbody>
        </table>

      </section>
    </div>
    <!-- *************************************** -->

    {%- endif -%}

  </div>









</div>

{% endblock %}
