{% extends "layout.html" %}

{% block pageTitle %}
Credits
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-6">
      Credits results
    </h1>
  </div>
  <div class="govuk-grid-column-full">

      <form class="form" method="post">
        <div class="govuk-form-group">
          <label class="govuk-label" for="width-20">
            Sender name, email address or prisoner number
          </label>
          <input class="govuk-input govuk-!-width-two-thirds" id="creditSearch" name="creditSearch" type="text" value="{{ data['creditSearch'] }}">
          {{ govukButton({
            html: 'Search'
          }) }}
          <p class="govuk-body"><a href="/advanced-search/" class="govuk-link govuk-link--no-visited-state">Advanced search</a></p>
        </div>
      </form>

      <p class="govuk-body-l">Search results for <span class="govuk-!-font-weight-bold">{{ data['creditSearch'] }}</span> <a href="/credits/" class="govuk-link--no-visited-state">clear search</a></p>

    <hr class="govuk-section-break govuk-section-break--s govuk-section-break--visible">

    <table class="govuk-table govuk-!-font-size-14 ">
      <!-- <caption class="govuk-table__caption">Credits for your prisons sorted by date</caption> -->
      <thead class="govuk-table__head">
        <tr class="govuk-table__row hack-table-row-vertical-align-top">
          <th class="govuk-table__header" scope="col">Date recieved</th>
          <th class="govuk-table__header" scope="col">Sender (from)</th>
          <th class="govuk-table__header" scope="col">Sender email address</th>
          <th class="govuk-table__header" scope="col">Prisoner (to)</th>
          <th class="govuk-table__header" scope="col">Prison</th>
          <!-- <th class="govuk-table__header" scope="col">Status</th> -->
          <th class="govuk-table__header govuk-table__header--numeric" scope="col">Amount</th>
          <th class="govuk-table__header govuk-table__header--numeric" scope="col">Action</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {%- for credit in credits -%}
          {#- if (credit.sender_name == data['creditSearch']) or (credit.sender_email == data['creditSearch']) or (credit.prisoner_number == data['creditSearch']) -#}
          {%- if data['creditSearch'] in [credit.sender_email,credit.prisoner_number,credit.sender_name] -%}
          <tr class="govuk-table__row hack-table-row-vertical-align-top">
            <td class="govuk-table__cell">{{ credit.received_at }}</td>
            <td class="govuk-table__cell"><a href="#" class="govuk-link--no-visited-state">{{ credit.sender_name }}</a><br>
              {%- if credit.card_number_last_digits -%}
                by Debit card
              {%- else -%}
                by Bank transfer
              {%- endif -%}
            </td>
            <td class="govuk-table__cell">
              {%- if credit.card_number_last_digits -%}
                {{ credit.sender_email }}
              {%- else -%}
                Not collected
              {%- endif -%}
            </td>
            <td class="govuk-table__cell"><a href="#" class="govuk-link--no-visited-state">{{ credit.prisoner_name }}</a><br>{{ credit.prisoner_number }}</td>
            <td class="govuk-table__cell">{{ credit.prison_name }}</td>
            <!-- <td class="govuk-table__cell title-caps">{{ credit.status }}</td> -->
            <td class="govuk-table__cell govuk-table__cell--numeric">{{ credit.amount }}</td>
            <td class="govuk-table__cell govuk-table__cell--numeric"><a href="#">View details</a></td>
          </tr>
          {%- endif -%}
        {%- endfor -%}


      </tbody>
    </table>

  </div>










</div>

{% endblock %}
